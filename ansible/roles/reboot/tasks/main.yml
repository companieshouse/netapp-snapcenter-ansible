---
- name: Reboot the server
  ansible.builtin.reboot:
    reboot_timeout: 300
    connect_timeout: 10
    pre_reboot_delay: 0
    post_reboot_delay: 10
    msg: "Reboot initiated by Ansible"

- name: Verify server is responsive after reboot
  ansible.builtin.ping:

- name: Wait for the SnapCenter API
  ansible.builtin.uri:
    url: "https://localhost:{{ snapcenter_webapp_port }}/api/version"
    method: GET
    validate_certs: false
    status_code: 200
  register: reboot_api_check
  until: reboot_api_check is not failed
  retries: 30
  delay: 10

- name: Display SnapCenter API version
  ansible.builtin.debug:
    msg: "SnapCenter {{ reboot_api_check.json.ProductVersion }} ({{ reboot_api_check.json.ServerVersion }}) is ready"
